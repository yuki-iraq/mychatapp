<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>MyChatApp</title>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-storage-compat.js"></script>

<style>
*{box-sizing:border-box;font-family:Arial}
body{
  margin:0;
  background:linear-gradient(160deg,#0e1621,#1b2a3a);
  color:white;
  overflow:hidden
}
.page{
  position:fixed;inset:0;
  display:none;
  flex-direction:column;
  animation:fade .3s ease
}
.page.active{display:flex}
@keyframes fade{from{opacity:0}to{opacity:1}}

button{
  cursor:pointer;
  transition:.2s;
}
button:active{transform:scale(.95)}
button:hover{opacity:.9}

/* ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ */
#page-login{justify-content:center;align-items:center}
.login-box{
  background:#17212b;
  padding:30px;
  border-radius:18px;
  width:90%;
  max-width:360px;
  text-align:center;
  box-shadow:0 10px 30px rgba(0,0,0,.4)
}
.login-box button{
  width:100%;
  padding:14px;
  border:none;
  border-radius:12px;
  background:#2aabee;
  color:white;
  font-size:16px
}

/* Ø´Ø±ÙŠØ· Ø¹Ù„ÙˆÙŠ */
.top{
  height:55px;
  background:#17212b;
  display:flex;
  align-items:center;
  justify-content:space-between;
  padding:0 14px;
  box-shadow:0 3px 10px rgba(0,0,0,.4)
}
.top span{font-size:22px}

/* Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø§Øª */
#list{flex:1;overflow-y:auto;padding:8px}
.chat-item{
  background:#17212b;
  margin-bottom:8px;
  padding:12px;
  border-radius:14px;
  display:flex;
  align-items:center;
  gap:10px;
  transition:.2s
}
.chat-item:hover{background:#1f2f40}
.avatar{
  width:48px;height:48px;
  border-radius:50%;
  background-size:cover;
  background-position:center
}
.unread{
  background:red;
  padding:2px 6px;
  border-radius:20px;
  font-size:12px;
  margin-right:6px
}

/* Ø§Ù„Ø´Ø§Øª */
#messages{flex:1;overflow-y:auto;padding:10px}
.msg{
  max-width:75%;
  padding:10px;
  margin:6px 0;
  border-radius:14px;
  background:#1c2f42
}
.me{background:#2aabee;margin-left:auto}
.msg img{max-width:240px;border-radius:12px}

/* Ø¥Ø¯Ø®Ø§Ù„ */
.input-bar{
  display:flex;
  gap:6px;
  padding:8px;
  background:#17212b
}
.input-bar input{
  flex:1;
  padding:10px;
  border:none;
  border-radius:12px
}
.input-bar button{
  background:#2aabee;
  border:none;
  border-radius:12px;
  padding:0 14px;
  color:white
}

/* Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª */
#settingsPanel{
  position:fixed;
  top:60px;
  right:10px;
  background:#17212b;
  border-radius:14px;
  padding:12px;
  display:none;
  width:200px
}
#settingsPanel button{
  width:100%;
  background:none;
  border:none;
  color:white;
  text-align:right;
  padding:10px
}

/* Ù…Ù„Ù Ø´Ø®ØµÙŠ */
#page-profile{
  padding:20px;
  gap:10px
}
#page-profile img{
  width:100px;height:100px;
  border-radius:50%;
  margin:auto;
  object-fit:cover
}
#page-profile input,#page-profile textarea{
  width:100%;
  padding:10px;
  border:none;
  border-radius:12px
}
.save-msg{
  color:#4caf50;
  text-align:center;
  display:none
}

/* Ø§ØªØµØ§Ù„ */
.call-bar{
  display:flex;
  gap:10px
}
.call-bar button{
  flex:1;
  background:#2aabee;
  border:none;
  border-radius:12px;
  padding:10px;
  color:white
}
</style>
</head>

<body>

<!-- ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ -->
<div id="page-login" class="page active">
  <div class="login-box">
    <h3>ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</h3>
    <button onclick="loginGoogle()">ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„ Google</button>
  </div>
</div>

<!-- Ù‚Ø§Ø¦Ù…Ø© -->
<div id="page-list" class="page">
  <div class="top">
    <strong>MyChatApp</strong>
    <span onclick="toggleSettings()">âš™ï¸</span>
  </div>
  <div id="list"></div>
</div>

<!-- Ø´Ø§Øª -->
<div id="page-chat" class="page">
  <div class="top">
    <span onclick="showList()">â¬…</span>
    <strong>Ø§Ù„Ø¯Ø±Ø¯Ø´Ø©</strong>
  </div>

  <div class="call-bar">
    <button onclick="startCall('audio')">ğŸ“ Ø§ØªØµØ§Ù„ ØµÙˆØªÙŠ</button>
    <button onclick="startCall('video')">ğŸ¥ Ù…ÙƒØ§Ù„Ù…Ø© ÙÙŠØ¯ÙŠÙˆ</button>
  </div>

  <div id="messages"></div>

  <div class="input-bar">
    <input type="text" id="msg" placeholder="Ø§ÙƒØªØ¨ Ø±Ø³Ø§Ù„Ø©...">
    <button onclick="send()">â¤</button>
  </div>
</div>

<!-- Ù…Ù„Ù Ø´Ø®ØµÙŠ -->
<div id="page-profile" class="page">
  <div class="top">
    <span onclick="showList()">â¬…</span>
    <strong>Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ</strong>
  </div>

  <img id="profileImg">
  <input type="file" id="profileImgInput">
  <input type="text" id="profileNameInput" placeholder="Ø§Ù„Ø§Ø³Ù…">
  <textarea id="profileBioInput" placeholder="Ø§Ù„Ø¨Ø§ÙŠÙˆ"></textarea>

  <button onclick="saveProfile()">ğŸ’¾ Ø­ÙØ¸</button>
  <div class="save-msg" id="saveMsg">âœ” ØªÙ… Ø­ÙØ¸ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª</div>
</div>

<!-- Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª -->
<div id="settingsPanel">
  <button onclick="openProfile()">ğŸ‘¤ Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ</button>
  <button onclick="logout()">ğŸšª ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬</button>
</div>

<script>
firebase.initializeApp({
  apiKey:"AIzaSyAdnzO83yV5sqL6TBrhStdyoxdoKlcR6yY",
  authDomain:"mychatapp-29f33.firebaseapp.com",
  projectId:"mychatapp-29f33",
  storageBucket:"mychatapp-29f33.appspot.com"
});

const auth=firebase.auth(),db=firebase.firestore();
let currentUser=null;

const pages={
 login:page-login,
 list:page-list,
 chat:page-chat,
 profile:page-profile
};

function showPage(p){
 Object.values(pages).forEach(x=>x.classList.remove("active"));
 p.classList.add("active");
}

function loginGoogle(){
 const p=new firebase.auth.GoogleAuthProvider();
 auth.signInWithPopup(p);
}

auth.onAuthStateChanged(u=>{
 if(u){
  currentUser=u;
  db.collection("users").doc(u.uid).set({
   name:u.displayName,
   photo:u.photoURL
  },{merge:true});
  showPage(pages.list);
 }
});

function toggleSettings(){
 settingsPanel.style.display=settingsPanel.style.display==="block"?"none":"block";
}

function openProfile(){
 profileImg.src=currentUser.photoURL;
 profileNameInput.value=currentUser.displayName;
 showPage(pages.profile);
 settingsPanel.style.display="none";
}

function saveProfile(){
 db.collection("users").doc(currentUser.uid).update({
  name:profileNameInput.value,
  bio:profileBioInput.value
 });
 saveMsg.style.display="block";
 setTimeout(()=>saveMsg.style.display="none",2000);
}

function startCall(type){
 alert(type==="audio"?"ğŸ“ Ø¨Ø¯Ø¡ Ø§ØªØµØ§Ù„ ØµÙˆØªÙŠ":"ğŸ¥ Ø¨Ø¯Ø¡ Ù…ÙƒØ§Ù„Ù…Ø© ÙÙŠØ¯ÙŠÙˆ");
}

function logout(){
 auth.signOut().then(()=>location.reload());
}
</script>
</body>
</html>